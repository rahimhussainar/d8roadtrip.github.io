<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smoky Mountains Family Trip Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally */
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #d1d5db; position: relative; padding-top: 0; }

        /* --- ADMIN MODE STYLES --- */
        #admin-banner { display: none; background-color: #fef08a; color: #713f12; padding: 8px 15px; text-align: center; font-weight: 500; font-size: 0.9rem; }
        #admin-banner button { background-color: #ca8a04; color: white; padding: 4px 10px; font-size: 0.8rem; margin-left: 15px; border-radius: 6px; }
        #admin-banner button:hover { background-color: #a16207; }
        .admin-only { display: none !important; }
        body.admin-mode .admin-only { display: inline-flex !important; } /* Default for buttons */
        body.admin-mode th.admin-only,
        body.admin-mode td.admin-only { display: table-cell !important; } /* For table elements */
        body:not(.admin-mode) select.status-select { pointer-events: none; opacity: 0.7; background-color: #4b5563 !important; border-color: #4b5563 !important; color: #9ca3af !important; }
        #admin-login-button { position: absolute; top: 15px; right: 20px; z-index: 50; }
        /* Make admin buttons slightly smaller */
        .button-admin-action { padding: 4px 8px !important; font-size: 0.75rem !important; gap: 0.25rem !important; }


        /* --- TYPOGRAPHY CLASSES --- */
        .text-main-title { font-size: 2.25rem; sm:font-size: 2.5rem; font-weight: 700; line-height: 1.2; }
        .text-subtitle { font-size: 1.1rem; sm:font-size: 1.125rem; font-weight: 400; color: #9ca3af; }
        .text-section-header { font-size: 1.5rem; sm:font-size: 1.75rem; font-weight: 600; color: #e5e7eb; }
        .text-table-header { font-weight: 600; color: #e5e7eb; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; white-space: nowrap; }
        .text-table-body { font-size: 0.85rem; line-height: 1.5; }
        .text-table-body-highlight { font-weight: 500; color: #e5e7eb; }
        .text-table-total { font-size: 1.1rem; font-weight: 600; color: #5eead4; }
        .text-card-title { font-size: 1.15rem; sm:font-size: 1.25rem; font-weight: 600; color: #e5e7eb; margin-bottom: 0.25rem; }
        .text-card-body { font-size: 0.9rem; color: #9ca3af; line-height: 1.6; }
        .text-card-detail { font-size: 0.8rem; sm:font-size: 0.85rem; color: #6b7280; }
        .text-card-cost { font-weight: 500; color: #5eead4; font-size: 0.9rem; sm:font-size: 0.95rem; }
        .text-modal-title { font-size: 1.3rem; sm:font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: #f3f4f6; }
        .text-label { display: block; margin-bottom: 6px; font-weight: 500; color: #9ca3af; font-size: 0.9rem; }
        .text-button { font-weight: 500; font-size: 0.9rem; }
        .text-input { font-size: 0.95rem; }
        .text-itinerary-item-name { font-weight: 500; color: #e5e7eb; }
        .text-itinerary-item-details { font-size: 0.85rem; color: #cbd5e1; }
        .text-info { font-size: 0.8rem; color: #6b7280; }
        .text-placeholder { font-size: 0.9rem; color: #6b7280; font-style: italic; }

        /* Header with Button Styling */
        .section-heading-container { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; padding-bottom: 0.75rem; border-bottom: 2px solid #374151; }

        /* General Table Styles */
        th, td { padding: 10px 12px; sm:padding: 12px 15px; text-align: left; border-bottom: 1px solid #374151; white-space: nowrap; vertical-align: middle; } /* Added vertical align */
        th { background-color: #1f2937; }
        tbody tr:nth-child(even) { background-color: #1f2937; }
        tbody tr:nth-child(odd) { background-color: #1a2233; }
        tbody tr:hover { background-color: #374151; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); border-radius: 10px; overflow: hidden; }
        tfoot tr { background-color: #1f2937 !important; font-weight: 600; }
        tfoot td { color: #e5e7eb; border-top: 2px solid #374151; }
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; border: 1px solid #374151; border-radius: 10px; margin-bottom: 1rem; }
         .table-wrapper table { margin-bottom: 0; border: none; border-radius: 0; }

        /* ATTENDEE TABLE SPECIFIC STYLES */
        #attendees-table th:last-child, /* Actions column header */
        #attendees-table td:last-child { /* Actions column cells */
            width: 15%; /* Adjust width for two buttons */
            text-align: right; /* Align buttons right */
        }
         #attendees-table td:last-child button { margin-left: 5px; } /* Space between buttons */


        /* FIXED COSTS TABLE SPECIFIC STYLES */
        #fixed-costs-table tbody tr { background-color: #1a2233; }
        #fixed-costs-table tbody tr:hover { background-color: #374151; }
        #fixed-costs-table th:last-child, #fixed-costs-table td:last-child { width: 10%; text-align: center; }

        /* Button Styles */
        button, .button { padding: 8px 16px; sm:padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.1s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); display: inline-flex; align-items: center; gap: 0.5rem; white-space: nowrap; }
        button:active, .button:active { transform: scale(0.98); }
        .button-primary { background-color: #2563eb; color: white; }
        .button-primary:hover { background-color: #1d4ed8; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        .button-secondary { background-color: #4b5563; color: #e5e7eb; }
        .button-secondary:hover { background-color: #374151; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        .button-delete { background-color: #991b1b; color: #fecaca; padding: 5px 10px; }
        .button-delete:hover { background-color: #7f1d1d; }
        .button-edit { background-color: #047857; color: #a7f3d0; padding: 5px 10px; } /* Teal edit button */
        .button-edit:hover { background-color: #065f46; }

        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); }
        .modal-content { background-color: #1f2937; margin: 5% auto; padding: 20px; sm:padding: 30px; border: 1px solid #374151; width: 90%; max-width: 600px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.4); color: #d1d5db; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-button { color: #9ca3af; position: absolute; top: 10px; sm:top: 15px; right: 15px; sm:right: 20px; font-size: 28px; sm:font-size: 32px; font-weight: bold; line-height: 1; cursor: pointer; transition: color 0.3s ease; }
        .close-button:hover, .close-button:focus { color: #f3f4f6; text-decoration: none; }

        /* Input Field Styles */
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea, input[type="file"] { width: 100%; padding: 10px 12px; margin-bottom: 15px; border: 1px solid #4b5563; border-radius: 6px; box-sizing: border-box; background-color: #374151; color: #e5e7eb; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus, input[type="time"]:focus, select:focus, textarea:focus, input[type="file"]:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); }
        input[type="date"]::-webkit-calendar-picker-indicator, input[type="time"]::-webkit-calendar-picker-indicator { background-color: #9ca3af; padding: 5px; border-radius: 3px; cursor: pointer; filter: invert(1); }
        input[type="file"]::file-selector-button { padding: 8px 15px; margin-right: 10px; border: none; border-radius: 4px; background-color: #4b5563; color: #e5e7eb; cursor: pointer; transition: background-color 0.3s ease; }
        input[type="file"]::file-selector-button:hover { background-color: #374151; }
        textarea { min-height: 80px; sm:min-height: 100px; resize: vertical; }
        .radio-group label { display: inline-flex; align-items: center; margin-right: 1rem; cursor: pointer; }
        .radio-group input[type="radio"] { margin-right: 0.5rem; accent-color: #2563eb; transform: scale(1.1); }

        /* Participant Checkbox Styling */
        .participant-list { background-color: #374151; border: 1px solid #4b5563; border-radius: 6px; padding: 15px; }
        .participant-list label { display: flex; align-items: center; margin-bottom: 10px; font-weight: normal; color: #d1d5db; cursor: pointer; font-size: 0.9rem; }
        .participant-list input[type="checkbox"] { margin-right: 12px; width: auto; margin-bottom: 0; accent-color: #2563eb; transform: scale(1.2); cursor: pointer; }

        /* Container & Headers */
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; sm:padding: 20px 30px; }

        /* Activity Card Styles */
        .activity-card { background-color: #1f2937; border: 1px solid #374151; border-radius: 10px; padding: 1rem; sm:padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15); display: flex; flex-direction: column; gap: 0.6rem; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .activity-card:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); }
        .activity-card img { max-width: 80px; max-height: 80px; sm:max-width: 100px; sm:max-height: 100px; border-radius: 8px; object-fit: cover; margin-bottom: 0.5rem; border: 2px solid #4b5563; align-self: center; }

        /* Status Dropdown */
        select.status-select { border-width: 2px; font-weight: 500; }

        /* ITINERARY TABLE STYLES */
        #itinerary-table th:first-child { font-size: 0.75rem !important; }
        #itinerary-table td:first-child { width: auto; text-align: center; font-size: 1.1rem; }
        #itinerary-table th:nth-child(2), #itinerary-table td:nth-child(2) { min-width: 150px; }
        #itinerary-table th:nth-child(3), #itinerary-table td:nth-child(3) { min-width: 120px; }
        #itinerary-table th:nth-child(4), #itinerary-table td:nth-child(4) { min-width: 130px; }
        #itinerary-table th:nth-child(5), #itinerary-table td:nth-child(5) { min-width: 150px; white-space: normal; }
        #itinerary-table th:last-child, #itinerary-table td:last-child { width: auto; text-align: center; }
        #itinerary-table td { vertical-align: middle; }

    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <div id="admin-banner">
        <span>ADMIN MODE ACTIVE</span>
        <button id="exit-admin-btn" class="button text-button">Exit Admin Mode</button>
    </div>

    <button id="admin-login-button" class="button button-secondary text-button">Admin Login</button>

    <div class="container mx-auto">
        <header class="text-center my-8 sm:my-12 flex flex-col sm:flex-row items-center justify-center">
            
            <img src="logo.png" alt="Trip Logo" class="h-12 w-auto sm:h-16 mb-3 sm:mb-0 sm:mr-4">
            <break>
            <div>
                <h1 class="text-main-title text-blue-400">Smoky Mountains Family Trip</h1>
                <p class="text-subtitle mt-1 sm:mt-2">Trip Planner & Cost Splitter</p>
            </div>
        </header>

        <section id="attendees" class="mb-8 sm:mb-10">
             <div class="section-heading-container">
                 <h2 class="text-section-header border-none p-0 m-0">Attendees & Costs</h2>
                 <button id="add-attendee-btn" class="button button-primary text-button admin-only">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                     Add Attendee
                 </button>
             </div>
             <div class="table-wrapper">
                 <table id="attendees-table" class="min-w-full">
                     <thead><tr>
                        <th class="text-table-header">Name</th>
                        <th class="text-table-header">Status</th>
                        <th class="text-table-header">Base Cost (Fixed)</th>
                        <th class="text-table-header">Activities Cost</th>
                        <th class="text-table-header">Total Owed</th>
                        <th class="text-table-header admin-only">Actions</th>
                    </tr></thead>
                    <tbody></tbody>
                </table>
            </div>
            <p class="text-info mt-2 sm:mt-3">Update status/attendees in Admin Mode.</p>
        </section>

        <section id="fixed-costs" class="mb-8 sm:mb-10">
             <div class="section-heading-container">
                 <h2 class="text-section-header border-none p-0 m-0">Fixed Costs</h2>
                 <button id="add-fixed-cost-btn" class="button button-primary text-button admin-only">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                     Add Fixed Cost
                 </button>
             </div>
             <div class="table-wrapper">
                 <table id="fixed-costs-table" class="min-w-full">
                     <thead><tr>
                         <th class="text-table-header">Item</th>
                         <th class="text-table-header">Total Cost</th>
                         <th class="text-table-header admin-only">Actions</th>
                     </tr></thead>
                     <tbody></tbody>
                     <tfoot>
                         <tr><td class="text-table-body">Total Fixed Costs:</td><td id="total-fixed-cost" class="text-table-body">$0.00</td><td class="admin-only"></td></tr>
                         <tr><td class="text-table-body">Confirmed Attendees:</td><td id="confirmed-attendees-count" class="text-table-body">0</td><td class="admin-only"></td></tr>
                         <tr><td class="text-table-body-highlight">Cost Per Confirmed Person:</td><td id="cost-per-person" class="text-table-total">$0.00</td><td class="admin-only"></td></tr>
                     </tfoot>
                 </table>
             </div>
        </section>

        <section id="activities" class="mb-8 sm:mb-10">
             <div class="section-heading-container">
                <h2 class="text-section-header border-none p-0 m-0">Activities</h2>
                <button id="add-activity-btn" class="button button-primary text-button admin-only"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg> Add New Activity </button>
            </div>
            <div id="activities-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                 </div>
        </section>

        <section id="itinerary" class="mb-8">
             <div class="section-heading-container">
                 <h2 class="text-section-header border-none p-0 m-0">Itinerary Details</h2>
                 <button id="add-itinerary-btn" class="button button-primary text-button admin-only"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /> </svg> Add Itinerary Item </button>
            </div>
             <div class="table-wrapper">
                 <table id="itinerary-table" class="min-w-full">
                     <thead><tr>
                         <th class="text-table-header">Icon</th>
                         <th class="text-table-header">Event</th>
                         <th class="text-table-header">Date Range</th>
                         <th class="text-table-header">Time Range</th>
                         <th class="text-table-header">Notes</th>
                         <th class="text-table-header admin-only">Actions</th>
                     </tr></thead>
                     <tbody id="itinerary-table-body">
                         <tr><td colspan="6" class="text-placeholder text-center py-4" id="no-itinerary-msg">No itinerary items added yet.</td></tr>
                     </tbody>
                </table>
            </div>
        </section>

    </div> <div id="activity-modal" class="modal"> <div class="modal-content"> <span class="close-button" onclick="closeModal('activity-modal')">&times;</span> <h3 class="text-modal-title">Add New Activity</h3> <form id="add-activity-form"> <div><label class="text-label" for="activity-name">Activity Name:</label><input class="text-input" type="text" id="activity-name" required></div> <div><label class="text-label" for="activity-price">Total Price ($):</label><input class="text-input" type="number" id="activity-price" min="0" step="0.01" required></div> <div><label class="text-label" for="activity-desc">Description:</label><textarea class="text-input" id="activity-desc"></textarea></div> <div><label class="text-label" for="activity-image">Image Upload (Optional):</label><input class="text-input" type="file" id="activity-image" accept="image/*"><p class="text-xs text-gray-500 mt-1">Note: Image preview/storage is not fully implemented.</p></div> <div class="mt-4"><label class="text-label">Who is participating?</label><div id="modal-participant-list" class="participant-list max-h-40 sm:max-h-48 overflow-y-auto"></div></div> <div class="mt-8 text-right"> <button type="button" class="button button-secondary text-button mr-3" onclick="closeModal('activity-modal')">Cancel</button> <button type="submit" class="button button-primary text-button">Add Activity</button> </div> </form> </div> </div>
    <div id="itinerary-modal" class="modal"> <div class="modal-content"> <span class="close-button" onclick="closeModal('itinerary-modal')">&times;</span> <h3 class="text-modal-title">Add Itinerary Item</h3> <form id="add-itinerary-form"> <div><label class="text-label" for="itinerary-icon">Icon (Emoji):</label><input class="text-input" type="text" id="itinerary-icon" placeholder="e.g., ‚úàÔ∏è, üèûÔ∏è, üçΩÔ∏è" maxlength="2"></div> <div><label class="text-label" for="itinerary-name">Event/Item Name:</label><input class="text-input" type="text" id="itinerary-name" required></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"> <div><label class="text-label" for="itinerary-start-date">Start Date:</label><input class="text-input" type="date" id="itinerary-start-date" required></div> <div><label class="text-label" for="itinerary-end-date">End Date:</label><input class="text-input" type="date" id="itinerary-end-date"></div> </div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"> <div><label class="text-label" for="itinerary-start-time">Start Time (Optional):</label><input class="text-input" type="time" id="itinerary-start-time"></div> <div><label class="text-label" for="itinerary-end-time">End Time (Optional):</label><input class="text-input" type="time" id="itinerary-end-time"></div> </div> <div><label class="text-label" for="itinerary-notes">Notes:</label><textarea class="text-input" id="itinerary-notes"></textarea></div> <div class="mt-8 text-right"> <button type="button" class="button button-secondary text-button mr-3" onclick="closeModal('itinerary-modal')">Cancel</button> <button type="submit" class="button button-primary text-button">Add Item</button> </div> </form> </div> </div>
    <div id="fixed-cost-modal" class="modal"> <div class="modal-content"> <span class="close-button" onclick="closeModal('fixed-cost-modal')">&times;</span> <h3 class="text-modal-title">Add Fixed Cost</h3> <form id="add-fixed-cost-modal-form"> <div> <label for="modal-fixed-cost-name" class="text-label">Item Name:</label> <input type="text" id="modal-fixed-cost-name" required class="text-input"> </div> <div> <label for="modal-fixed-cost-amount" class="text-label">Amount ($):</label> <input type="number" id="modal-fixed-cost-amount" min="0" step="0.01" required class="text-input"> </div> <div class="mt-8 text-right"> <button type="button" class="button button-secondary text-button mr-3" onclick="closeModal('fixed-cost-modal')">Cancel</button> <button type="submit" class="button button-primary text-button">Add Cost</button> </div> </form> </div> </div>
    <div id="attendee-modal" class="modal"> <div class="modal-content"> <span class="close-button" onclick="closeModal('attendee-modal')">&times;</span> <h3 class="text-modal-title">Add Attendee</h3> <form id="add-attendee-modal-form"> <div> <label for="modal-attendee-name" class="text-label">Attendee Name:</label> <input type="text" id="modal-attendee-name" required class="text-input"> </div> <div> <label class="text-label">Initial Status:</label> <div class="radio-group text-table-body"> <label> <input type="radio" name="modal-attendee-status" value="Undecided" checked> Undecided </label> <label> <input type="radio" name="modal-attendee-status" value="Confirmed"> Confirmed </label> <label> <input type="radio" name="modal-attendee-status" value="Not Coming"> Not Coming </label> </div> </div> <div class="mt-8 text-right"> <button type="button" class="button button-secondary text-button mr-3" onclick="closeModal('attendee-modal')">Cancel</button> <button type="submit" class="button button-primary text-button">Add Attendee</button> </div> </form> </div> </div>


    <script>
        // --- Data Store ---
        let attendees = [ { id: 1, name: "Alice", status: "Undecided" }, { id: 2, name: "Bob", status: "Confirmed" }, { id: 3, name: "Charlie", status: "Confirmed" }, { id: 4, name: "Diana", status: "Not Coming" }, { id: 5, name: "Ethan", status: "Undecided" }, ];
        let nextAttendeeId = 6;
        let fixedCosts = [ { id: 1, name: "Cabin Rental", amount: 1500.00 }, { id: 2, name: "Groceries (Initial)", amount: 300.00 }, ];
        let nextFixedCostId = 3;
        let activities = []; let nextActivityId = 1;
        let itineraryItems = [ { id: 1, icon: "üèûÔ∏è", name: "Hike to Clingmans Dome", startDate: "2025-06-26", endDate: "2025-06-26", startTime: "06:00", endTime: "10:00", notes: "Sunrise hike, leave early!" }, { id: 2, icon: "üöó", name: "Drive Cades Cove Loop", startDate: "2025-06-27", endDate: "2025-06-27", startTime: "10:30", endTime: "15:00", notes: "Pack lunch, look for bears" }, { id: 3, icon: "üçΩÔ∏è", name: "Dinner at The Peddler", startDate: "2025-06-28", endDate: "", startTime: "19:00", endTime: "", notes: "Steakhouse" }, { id: 4, icon: "üé¢", name: "Dollywood", startDate: "2025-06-29", endDate: "2025-06-30", startTime: "09:00", endTime: "18:00", notes: "Full two days planned" }, { id: 5, icon: "ü•û", name: "Pancake Pantry Breakfast", startDate: "2025-06-29", endDate: "2025-06-29", startTime: "07:30", endTime: "08:30", notes: "Before Dollywood" } ];
        let nextItineraryId = 6;

        // --- Admin Mode State ---
        let isAdminMode = false;
        const ADMIN_PIN = '1234'; // IMPORTANT: Hardcoded PIN, not secure for real use!

        // --- DOM Elements ---
        const attendeesTableBody = document.querySelector("#attendees-table tbody");
        const fixedCostsTableBody = document.querySelector("#fixed-costs-table tbody");
        const totalFixedCostEl = document.getElementById("total-fixed-cost");
        const confirmedAttendeesCountEl = document.getElementById("confirmed-attendees-count");
        const costPerPersonEl = document.getElementById("cost-per-person");
        const activitiesListEl = document.getElementById("activities-list");
        const activityModal = document.getElementById("activity-modal");
        const addActivityBtn = document.getElementById("add-activity-btn");
        const addActivityForm = document.getElementById("add-activity-form");
        const modalParticipantListEl = document.getElementById("modal-participant-list");
        const activityImageInput = document.getElementById("activity-image");
        const itineraryTableBody = document.querySelector("#itinerary-table tbody");
        const itineraryModal = document.getElementById("itinerary-modal");
        const addItineraryBtn = document.getElementById("add-itinerary-btn");
        const addItineraryForm = document.getElementById("add-itinerary-form");
        const noItineraryMsgTable = document.getElementById("no-itinerary-msg");
        const addFixedCostBtn = document.getElementById("add-fixed-cost-btn");
        const fixedCostModal = document.getElementById("fixed-cost-modal");
        const addFixedCostModalForm = document.getElementById("add-fixed-cost-modal-form");
        const addAttendeeBtn = document.getElementById("add-attendee-btn");
        const attendeeModal = document.getElementById("attendee-modal");
        const addAttendeeModalForm = document.getElementById("add-attendee-modal-form");
        // Admin Elements
        const adminLoginBtn = document.getElementById("admin-login-button");
        const adminBanner = document.getElementById("admin-banner");
        const exitAdminBtn = document.getElementById("exit-admin-btn");
        const bodyEl = document.body;

        // --- Core Logic ---
        function calculateCosts() { /* ... */
            const totalFixed = fixedCosts.reduce((sum, cost) => sum + cost.amount, 0);
            const confirmedAttendees = attendees.filter(a => a.status === 'Confirmed');
            const confirmedCount = confirmedAttendees.length;
            const baseCostPerPerson = confirmedCount > 0 ? totalFixed / confirmedCount : 0;
            const attendeeCosts = {};
            attendees.forEach(attendee => {
                let personBaseCost = (attendee.status === 'Confirmed') ? baseCostPerPerson : 0;
                let personActivitiesCost = 0;
                activities.forEach(activity => {
                    if (activity.participants.includes(attendee.id)) {
                        const activityParticipantsCount = activity.participants.length;
                        personActivitiesCost += (activityParticipantsCount > 0 ? activity.price / activityParticipantsCount : 0);
                    }
                });
                attendeeCosts[attendee.id] = { base: personBaseCost, activities: personActivitiesCost, total: personBaseCost + personActivitiesCost };
            });
            return { totalFixed, confirmedCount, baseCostPerPerson, attendeeCosts };
         }

        // --- Rendering Functions ---
        function formatCurrency(amount) { /* ... */
             if (isNaN(amount) || typeof amount !== 'number') return '$0.00';
            return amount.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        }
        // Updated renderAttendeesTable to include Rename/Delete buttons
        function renderAttendeesTable() {
            const costs = calculateCosts(); attendeesTableBody.innerHTML = "";
            if (attendees.length === 0) { attendeesTableBody.innerHTML = `<tr><td colspan="6" class="text-placeholder text-center py-4">No attendees added yet.</td></tr>`; } // Colspan is 6 now
            else {
                attendees.forEach(attendee => {
                    const attendeeCost = costs.attendeeCosts[attendee.id]; const row = attendeesTableBody.insertRow();
                    const disabledAttr = isAdminMode ? '' : 'disabled';
                    // Added Actions cell
                    row.innerHTML = `
                        <td class="text-table-body-highlight">${attendee.name}</td>
                        <td><select class="status-select text-input" data-attendee-id="${attendee.id}" ${disabledAttr}></select></td>
                        <td class="text-table-body">${formatCurrency(attendeeCost.base)}</td>
                        <td class="text-table-body">${formatCurrency(attendeeCost.activities)}</td>
                        <td class="text-table-body-highlight text-blue-300">${formatCurrency(attendeeCost.total)}</td>
                        <td class="text-center admin-only">
                            <button class="button button-edit text-button button-admin-action" onclick="promptRenameAttendee(${attendee.id})">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                            </button>
                            <button class="button button-delete text-button button-admin-action" onclick="deleteAttendee(${attendee.id})">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                            </button>
                        </td>
                    `;
                    const select = row.querySelector('select'); ["Undecided", "Confirmed", "Not Coming"].forEach(status => { const option = new Option(status, status); if (attendee.status === status) option.selected = true; select.add(option); });
                    updateStatusSelectBackground(select, attendee.status);
                    if (isAdminMode) { select.addEventListener('change', handleStatusChange); }
                });
            }
         }
        function updateStatusSelectBackground(selectElement, status) { /* ... */
             selectElement.className = 'status-select text-input rounded p-1.5 border-2'; let statusClasses = '';
             switch (status) { case 'Confirmed': statusClasses = 'bg-green-700 text-green-100 border-green-500'; break; case 'Not Coming': statusClasses = 'bg-red-800 text-red-100 border-red-600'; break; default: statusClasses = 'bg-yellow-700 text-yellow-100 border-yellow-500'; break; }
             selectElement.classList.add(...statusClasses.split(' '));
        }
        function renderFixedCostsTable() { /* ... */
            const costs = calculateCosts(); fixedCostsTableBody.innerHTML = "";
            if (fixedCosts.length === 0) { fixedCostsTableBody.innerHTML = `<tr><td colspan="3" class="text-placeholder text-center py-4">No fixed costs added yet.</td></tr>`; }
            else {
                fixedCosts.forEach(cost => {
                    const row = fixedCostsTableBody.insertRow();
                    row.innerHTML = ` <td class="text-table-body-highlight">${cost.name}</td> <td class="text-table-body">${formatCurrency(cost.amount)}</td> <td class="text-center admin-only"> <button class="button button-delete text-button button-admin-action" onclick="deleteFixedCost(${cost.id})"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg> </button> </td> `;
                });
            }
            totalFixedCostEl.textContent = formatCurrency(costs.totalFixed); confirmedAttendeesCountEl.textContent = costs.confirmedCount; costPerPersonEl.textContent = formatCurrency(costs.baseCostPerPerson);
        }
        function renderActivitiesList() { /* ... */
            activitiesListEl.innerHTML = ""; if (activities.length === 0) { activitiesListEl.innerHTML = `<p class="text-placeholder col-span-full text-center py-6">No activities added yet.</p>`; return; }
            activities.forEach(activity => {
                const card = document.createElement("div"); card.classList.add('activity-card'); const participantCount = activity.participants.length; const costPer = participantCount > 0 ? activity.price / participantCount : 0; const participantNames = attendees.filter(a => activity.participants.includes(a.id)).map(a => a.name).join(", ");
                card.innerHTML = ` <div class="flex justify-center mb-2"> <img src="${activity.imageUrl || `https://placehold.co/100x100/374151/9ca3af?text=Activity`}" alt="${activity.name}" onerror="this.onerror=null; this.src='https://placehold.co/100x100/374151/9ca3af?text=No+Image';" class="activity-card-img"> </div> <h3 class="text-card-title">${activity.name}</h3> ${activity.description ? `<p class="text-card-body">${activity.description}</p>` : ''} <p class="text-card-cost"><span>Cost:</span> ${formatCurrency(activity.price)} total (${formatCurrency(costPer)} per participant)</p> <p class="text-card-detail"><span>Participants (${participantCount}):</span> ${participantNames || 'None'}</p> `;
                activitiesListEl.appendChild(card);
            });
        }
        function renderItineraryTable() { /* ... */
            itineraryTableBody.innerHTML = ''; if (itineraryItems.length === 0) { itineraryTableBody.innerHTML = `<tr><td colspan="6" class="text-placeholder text-center py-4" id="no-itinerary-msg">No itinerary items added yet.</td></tr>`; return; }
            itineraryItems.sort((a, b) => { const dateA = new Date(a.startDate + 'T' + (a.startTime || '00:00') + ':00Z'); const dateB = new Date(b.startDate + 'T' + (b.startTime || '00:00') + ':00Z'); return dateA - dateB; });
            itineraryItems.forEach(item => {
                const row = itineraryTableBody.insertRow(); row.dataset.itemId = item.id; let dateRange = formatDate(item.startDate); if (item.endDate && item.endDate !== item.startDate) { dateRange += ` - ${formatDate(item.endDate)}`; } let timeRange = ''; if (item.startTime) { timeRange = formatTime(item.startTime); if (item.endTime) { timeRange += ` - ${formatTime(item.endTime)}`; } } else { timeRange = 'N/A'; }
                row.innerHTML = ` <td class="text-center text-table-body">${item.icon || 'üìù'}</td> <td class="text-itinerary-item-name">${item.name}</td> <td class="text-itinerary-item-details">${dateRange}</td> <td class="text-itinerary-item-details">${timeRange}</td> <td class="text-table-body">${item.notes || ''}</td> <td class="text-center admin-only"> <button class="button button-delete text-button button-admin-action" onclick="deleteItineraryItem(${item.id})"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /> </svg> </button> </td> `;
            });
        }
        function formatDate(dateString, options = { month: 'short', day: 'numeric', year: 'numeric' }) { /* ... */
            if (!dateString) return ''; const date = new Date(dateString + 'T00:00:00Z'); if (isNaN(date)) return ''; return date.toLocaleDateString('en-US', { ...options, timeZone: 'UTC' });
        }
        function formatTime(timeString) { /* ... */
             if (!timeString) return ''; try { const [hours, minutes] = timeString.split(':'); const hour = parseInt(hours, 10); const minute = parseInt(minutes, 10); const ampm = hour >= 12 ? 'PM' : 'AM'; const formattedHour = hour % 12 === 0 ? 12 : hour % 12; const formattedMinutes = minute.toString().padStart(2, '0'); return `${formattedHour}:${formattedMinutes} ${ampm}`; } catch (e) { console.error("Error formatting time:", timeString, e); return timeString; }
        }

        // --- Admin Mode UI Update ---
        function updateAdminUI() {
            if (isAdminMode) {
                bodyEl.classList.add('admin-mode');
                adminBanner.style.display = 'block';
                adminLoginBtn.style.display = 'none';
            } else {
                bodyEl.classList.remove('admin-mode');
                adminBanner.style.display = 'none';
                 adminLoginBtn.style.display = 'inline-flex';
            }
             renderAttendeesTable(); renderFixedCostsTable(); renderItineraryTable();
        }

        // --- Event Handlers ---
        function handleStatusChange(event) { /* ... */
            const selectElement = event.target; const attendeeId = parseInt(selectElement.dataset.attendeeId); const newStatus = selectElement.value;
            const attendee = attendees.find(a => a.id === attendeeId); if (attendee) { attendee.status = newStatus; updateStatusSelectBackground(selectElement, newStatus); renderAllCostsAndAttendees(); }
        }
        function openModal(modalId) { /* Added Admin Check */
            if (!isAdminMode && ['attendee-modal', 'fixed-cost-modal', 'activity-modal', 'itinerary-modal'].includes(modalId)) {
                alert("Please login as Admin to make changes."); return;
            }
            const modal = document.getElementById(modalId); if (modal) { const form = modal.querySelector('form'); if (form) form.reset(); if (modalId === 'activity-modal') { activityImageInput.value = ''; populateModalParticipants(); document.getElementById('activity-name').focus(); } else if (modalId === 'itinerary-modal') { document.getElementById('itinerary-name').focus(); } else if (modalId === 'fixed-cost-modal') { document.getElementById('modal-fixed-cost-name').focus(); } else if (modalId === 'attendee-modal') { document.getElementById('modal-attendee-name').focus(); } modal.style.display = "block"; }
        }
        function closeModal(modalId) { /* ... */
             const modal = document.getElementById(modalId); if (modal) modal.style.display = "none";
        }
        function handleAddActivitySubmit(event) { /* ... */
            event.preventDefault(); const name = document.getElementById("activity-name").value.trim(); const price = parseFloat(document.getElementById("activity-price").value); const description = document.getElementById("activity-desc").value.trim(); const imageFile = activityImageInput.files[0]; const participantCheckboxes = modalParticipantListEl.querySelectorAll('input[type="checkbox"]:checked'); const participantIds = Array.from(participantCheckboxes).map(cb => parseInt(cb.value));
            if (!name || isNaN(price) || price < 0) { alert("Please enter a valid activity name and price."); return; } let imageUrl = null; if (imageFile) { if (!imageFile.type.startsWith('image/')){ alert("Please upload a valid image file."); return; } if (imageFile.size > 5 * 1024 * 1024) { alert("Image file size should not exceed 5MB."); return; } imageUrl = URL.createObjectURL(imageFile); }
            const newActivity = { id: nextActivityId++, name, price, description, imageUrl, participants: participantIds }; activities.push(newActivity); closeModal('activity-modal'); renderAll();
        }
        function handleAddItinerarySubmit(event) { /* ... */
             event.preventDefault(); const icon = document.getElementById("itinerary-icon").value.trim(); const name = document.getElementById("itinerary-name").value.trim(); const startDate = document.getElementById("itinerary-start-date").value; const endDate = document.getElementById("itinerary-end-date").value; const startTime = document.getElementById("itinerary-start-time").value; const endTime = document.getElementById("itinerary-end-time").value; const notes = document.getElementById("itinerary-notes").value.trim();
             if (!name || !startDate) { alert("Please enter at least an event name and start date."); return; } if (endDate && startDate && new Date(endDate) < new Date(startDate)) { alert("End date cannot be before start date."); return; } if (startDate === endDate && startTime && endTime && endTime <= startTime) { alert("End time must be after start time for single-day events."); return; }
             const newItem = { id: nextItineraryId++, icon, name, startDate, endDate: endDate || startDate, startTime, endTime, notes }; itineraryItems.push(newItem); closeModal('itinerary-modal');
             renderItineraryTable();
        }
        function deleteItineraryItem(itemId) { /* Added Admin Check */
             if (!isAdminMode) { alert("Admin mode required to delete items."); return; }
             if (confirm('Are you sure you want to delete this itinerary item?')) { itineraryItems = itineraryItems.filter(item => item.id !== itemId); renderItineraryTable(); }
        }
        function handleAddFixedCostSubmit(event) { /* ... */
            event.preventDefault(); const nameInput = document.getElementById("modal-fixed-cost-name"); const amountInput = document.getElementById("modal-fixed-cost-amount"); const name = nameInput.value.trim(); const amount = parseFloat(amountInput.value);
            if (!name || isNaN(amount) || amount <= 0) { alert("Please enter a valid item name and positive amount for the fixed cost."); return; }
            const newCost = { id: nextFixedCostId++, name: name, amount: amount }; fixedCosts.push(newCost); closeModal('fixed-cost-modal'); renderAllCostsAndAttendees();
        }
        function deleteFixedCost(costId) { /* Added Admin Check */
            if (!isAdminMode) { alert("Admin mode required to delete items."); return; }
            const costToDelete = fixedCosts.find(cost => cost.id === costId); if (!costToDelete) return;
            if (confirm(`Are you sure you want to delete the fixed cost "${costToDelete.name}"?`)) { fixedCosts = fixedCosts.filter(cost => cost.id !== costId); renderAllCostsAndAttendees(); }
        }
        function handleAddAttendeeSubmit(event) { /* ... */
            event.preventDefault(); const nameInput = document.getElementById("modal-attendee-name"); const name = nameInput.value.trim(); const statusInput = addAttendeeModalForm.querySelector('input[name="modal-attendee-status"]:checked'); const status = statusInput ? statusInput.value : 'Undecided';
            if (!name) { alert("Please enter the attendee's name."); return; } if (attendees.some(att => att.name.toLowerCase() === name.toLowerCase())) { alert(`Attendee "${name}" already exists.`); return; }
            const newAttendee = { id: nextAttendeeId++, name: name, status: status }; attendees.push(newAttendee); closeModal('attendee-modal'); renderAllCostsAndAttendees();
        }
        // --- New Attendee Management Handlers ---
        function promptRenameAttendee(attendeeId) {
            if (!isAdminMode) { alert("Admin mode required to rename attendees."); return; }
            const attendee = attendees.find(a => a.id === attendeeId);
            if (!attendee) return;

            const currentName = attendee.name;
            const newName = prompt(`Enter new name for "${currentName}":`, currentName);

            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                 const trimmedNewName = newName.trim();
                 // Check if new name already exists (case-insensitive, excluding self)
                 if (attendees.some(att => att.id !== attendeeId && att.name.toLowerCase() === trimmedNewName.toLowerCase())) {
                     alert(`Attendee name "${trimmedNewName}" already exists.`);
                     return;
                 }
                 // Update the name
                 attendee.name = trimmedNewName;
                 // Re-render relevant parts (attendee table, potentially activity cards if names are displayed)
                 renderAllCostsAndAttendees(); // Simplest way to update all potential name displays
                 // Also update participant list in activity modal if it's open
                 if (activityModal.style.display === 'block') {
                     populateModalParticipants();
                 }

            } else if (newName !== null) { // User entered empty string or same name
                 alert("Invalid or unchanged name provided.");
            }
        }

        function deleteAttendee(attendeeId) {
             if (!isAdminMode) { alert("Admin mode required to delete attendees."); return; }
             const attendee = attendees.find(a => a.id === attendeeId);
             if (!attendee) return;

             // Check if attendee has costs associated or is only participant in an activity? (Optional check)
             // For now, just confirm deletion.
             if (confirm(`Are you sure you want to delete attendee "${attendee.name}"? This cannot be undone.`)) {
                 // Remove attendee from main list
                 attendees = attendees.filter(a => a.id !== attendeeId);

                 // Remove attendee from any activity participant lists
                 activities.forEach(activity => {
                     activity.participants = activity.participants.filter(pId => pId !== attendeeId);
                 });

                 // Re-render everything
                 renderAllCostsAndAttendees();
                  // Also update participant list in activity modal if it's open
                 if (activityModal.style.display === 'block') {
                     populateModalParticipants();
                 }
             }
        }


        // --- Admin Login/Logout ---
        function attemptAdminLogin() {
            console.log("Admin login button clicked!");
            const pinEntered = prompt("Enter Admin PIN:");
            if (pinEntered === ADMIN_PIN) { isAdminMode = true; updateAdminUI(); }
            else if (pinEntered !== null) { alert("Incorrect PIN."); }
        }
        function exitAdminMode() { isAdminMode = false; updateAdminUI(); }

        function populateModalParticipants() { /* ... */
            modalParticipantListEl.innerHTML = ""; attendees.forEach(attendee => { if (attendee.status !== 'Not Coming') { const label = document.createElement('label'); const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.value = attendee.id; checkbox.id = `modal-participant-${attendee.id}`; checkbox.checked = attendee.status === 'Confirmed'; label.appendChild(checkbox); label.appendChild(document.createTextNode(` ${attendee.name}`)); modalParticipantListEl.appendChild(label); } });
        }
        function renderAllCostsAndAttendees() { renderFixedCostsTable(); renderAttendeesTable(); renderActivitiesList(); }
        function renderStaticSections() { renderItineraryTable(); }
        function renderAll() { updateAdminUI(); renderAllCostsAndAttendees(); renderStaticSections(); }

        // --- Initialization ---
        addActivityBtn.addEventListener('click', () => openModal('activity-modal')); addActivityForm.addEventListener('submit', handleAddActivitySubmit);
        addItineraryBtn.addEventListener('click', () => openModal('itinerary-modal')); addItineraryForm.addEventListener('submit', handleAddItinerarySubmit);
        addFixedCostBtn.addEventListener('click', () => openModal('fixed-cost-modal')); addFixedCostModalForm.addEventListener('submit', handleAddFixedCostSubmit);
        addAttendeeBtn.addEventListener('click', () => openModal('attendee-modal')); addAttendeeModalForm.addEventListener('submit', handleAddAttendeeSubmit);
        adminLoginBtn.addEventListener('click', attemptAdminLogin); exitAdminBtn.addEventListener('click', exitAdminMode);

        window.onclick = function(event) { if (event.target.classList.contains('modal')) closeModal(event.target.id); }
        window.addEventListener('keydown', function(event) { if (event.key === 'Escape') { closeModal('activity-modal'); closeModal('itinerary-modal'); closeModal('fixed-cost-modal'); closeModal('attendee-modal');} });
        window.addEventListener('beforeunload', () => { activities.forEach(activity => { if (activity.imageUrl && activity.imageUrl.startsWith('blob:')) URL.revokeObjectURL(activity.imageUrl); }); });

        renderAll(); // Initial Render

    </script>

</body>
</html>

